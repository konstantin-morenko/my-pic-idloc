## Моя структура IdLoc для микроконтроллеров Microchip Pic(r)

### Предпосылка

Я пишу достаточное количество программ и со временем становится трудно
в них разобраться.  И уж тем более в том, в каком микроконтроллере
записана какая версия программы.

Поскольку каждый байт в микроконтроллерах среднего семейства
реализован только в нижней половине, то диапазон значений для них
составляет 0-15 (или 0-F).  И таких байт четыре: 3-0.

### Механизм назначения IdLoc

1. Для новых программ
2. При изменении любой части номера версии (согласно
   https://semver.org/, с обязательным назначением тега вида `vX.Y.Z`
   в репозитарии)
3. Для вариантов сборок (например, общие катоды и аноды или варианты
   для разных марок микроконтроллеров)

Можно было бы разделить четыре байта на части: код программы, мажорный
номер, минорный номер, номер патча, но большая часть из них никогда не
будет израсходована, а количество программ тогда будет ограничено 16
штуками.  Уже сейчас этого недостаточно.

Полное количество бит позволяет хранить 2 полных байта, что составляет
65536 значений.

Номера назначаются по порядку.  Это похоже на серийные номера.

### Установка IdLoc

Установка IdLoc выполняется с помощью директив `#pragma` (например, в
[моем шаблоне](https://github.com/konstantin-morenko/pic-template/blob/master/src/confbits.c)):

    #pragma config IDLOC3 = 0x0
    #pragma config IDLOC2 = 0x0
    #pragma config IDLOC1 = 0x0
    #pragma config IDLOC0 = 0x0

### Чтение IdLoc

### Описание полей файла `_data/idlocs.yaml`

- `idloc30`: перечень значений IdLoc от старшего (3) к младшему (0),
  разделенных знаком "-".  Назначаются по порядку в шестнадцатеричном
  формате, максимальное значение каждого разряда - "F"
- `state`: текущий статус идентификатора.  Если есть более новая
  версия программы, то здесь указывается новый `idloc30`.
- `date`: дата создания IdLoc в формате `YYYY-MM-DD`
- `program`: идентификатор программы
- `repo`: ссылка на репозитарий программы (подставляется в поле
  `program`)
- `ver`: идентификатор версии согласно [semver.org](https://semver.org)
- `tag`: ссылка на тег соответствующей версии в формате `vX.Y.Z`
  (подставляется в поле `ver`)
- `chip`: марка микроконтроллера
- `build`: опции сборки в виде макросов
- `notes`: дополнительные примечания

### Перечень IdLoc

В перечне IdLoc для каждого заданы якоря в том же виде, в каком они
представлены в поле IdLoc30.

IdLoc `0 0 0 0` заререзвирован в качестве шаблона в файле
`_data/idlocs.yaml` и используется для начальной инициализации IdLoc.

<table>
	<thead>
		<tr>
			<td>IdLoc30</td>
			<td>Статус</td>
			<td>Дата</td>
			<td>Программа</td>
			<td>Версия</td>
			<td>Контроллер</td>
			<td>Сборка</td>
			<td>Примечания</td>
		</tr>
	</thead>
	<tbody>
	{% for id in site.data.idlocs %}
		<tr>
			<td><a id="{{ id.idloc30 }}">{{ id.idloc30 }}</a></td>
			<td>
				{% unless id.state == "" %}
					<a href="#{{ id.state }}">{{ id.state }}</a>
				{% endunless %}
			</td>
			<td>{{ id.date }}</td>
			<td><a href="{{ id.repo }}">{{ id.program }}</a></td>
			<td><a href="{{ id.tag }}">{{ id.ver }}</a></td>
			<td>{{ id.chip }}</td>
			<td>{{ id.build }}</td>
			<td>{{ id.notes }}</td>
		</tr>
	{% endfor %}
	</tbody>
</table>
